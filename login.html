<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clearance Verification // UT Forums</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Special+Elite&display=swap" rel="stylesheet">
    <style>
        :root { --color-red: #CD201F; --color-black: #050505; --color-gray: #333; }
        * { box-sizing: border-box; }
        
        body {
            background-color: var(--color-black);
            color: #fff;
            font-family: 'Oswald', sans-serif;
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; margin: 0;
            background-image: radial-gradient(circle at center, #1a1a1a 0%, #000 100%);
        }

        .login-card {
            width: 100%; max-width: 420px;
            padding: 2.5rem;
            border: 1px solid var(--color-gray);
            background: rgba(10, 10, 10, 0.95);
            position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }
        
        /* Red Glow Border */
        .login-card::before {
            content: ''; position: absolute; top: -1px; left: -1px; right: -1px; bottom: -1px;
            background: linear-gradient(45deg, var(--color-red), transparent, var(--color-red));
            z-index: -1; filter: blur(5px); opacity: 0.4;
        }

        h1 { margin: 0 0 5px 0; letter-spacing: 2px; text-transform: uppercase; color: #fff; text-align: center; }
        .sub-text { font-family: 'Special Elite', cursive; color: #666; font-size: 0.8rem; margin-bottom: 1.5rem; text-align: center; display: block; }

        /* TABS */
        .tabs { display: flex; border-bottom: 1px solid var(--color-gray); margin-bottom: 1.5rem; }
        .tab {
            flex: 1; padding: 10px; text-align: center; cursor: pointer;
            font-family: 'Special Elite', cursive; color: #666; transition: all 0.3s;
        }
        .tab.active { color: var(--color-red); border-bottom: 2px solid var(--color-red); }

        /* FORMS */
        .form-group { margin-bottom: 1rem; }
        input {
            width: 100%; padding: 12px; background: #000; border: 1px solid var(--color-gray);
            color: #fff; font-family: 'Special Elite', cursive; outline: none; transition: border 0.3s;
        }
        input:focus { border-color: var(--color-red); }

        /* BUTTONS */
        .btn-main {
            width: 100%; padding: 12px; background: var(--color-red); color: #fff;
            border: none; font-family: 'Oswald', sans-serif; font-size: 1.1rem;
            cursor: pointer; transition: all 0.3s; margin-top: 10px;
        }
        .btn-main:hover { background: #ff4d4d; box-shadow: 0 0 15px rgba(205, 32, 31, 0.4); }

        .btn-google {
            width: 100%; padding: 12px; background: #fff; color: #000;
            border: none; font-family: 'Oswald', sans-serif; font-size: 1rem;
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;
            margin-top: 1rem; transition: transform 0.2s;
        }
        .btn-google:hover { transform: scale(1.02); }

        .link-btn {
            background: none; border: none; color: #666; cursor: pointer;
            font-family: 'Special Elite', cursive; font-size: 0.8rem; margin-top: 10px;
            text-decoration: underline; display: block; width: 100%; text-align: center;
        }
        .link-btn:hover { color: var(--color-red); }

        .error-msg { color: var(--color-red); font-size: 0.9rem; text-align: center; margin-top: 10px; display: none; }
        .success-msg { color: #00ff00; font-size: 0.9rem; text-align: center; margin-top: 10px; display: none; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="login-card">
        <h1>FORUM ACCESS</h1>
        <span class="sub-text">IDENTITY VERIFICATION PROTOCOL</span>

        <div class="tabs">
            <div class="tab active" id="tabLogin">LOGIN</div>
            <div class="tab" id="tabRegister">REGISTER</div>
        </div>

        <form id="loginForm">
            <div class="form-group">
                <input type="email" id="loginEmail" placeholder="OPERATIVE EMAIL" required>
            </div>
            <div class="form-group">
                <input type="password" id="loginPass" placeholder="PASSWORD" required>
            </div>
            <button type="submit" class="btn-main" id="btnLogin">ACCESS TERMINAL</button>
            <button type="button" class="link-btn" id="btnForgot">FORGOT PASSWORD?</button>
        </form>

        <form id="registerForm" class="hidden">
            <p style="color:#aaa; font-size:0.8rem; text-align:center; margin-bottom:1rem;">
                WARNING: EMAIL VERIFICATION REQUIRED.
            </p>
            <div class="form-group">
                <input type="email" id="regEmail" placeholder="VALID EMAIL ADDRESS" required>
            </div>
            <div class="form-group">
                <input type="password" id="regPass" placeholder="CREATE PASSWORD (MIN 6 CHARS)" required minlength="6">
            </div>
            <div class="form-group">
                <input type="password" id="regPassConfirm" placeholder="CONFIRM PASSWORD" required>
            </div>
            <button type="submit" class="btn-main" id="btnRegister">INITIATE REGISTRATION</button>
        </form>

        <form id="forgotForm" class="hidden">
            <p style="color:#aaa; font-size:0.8rem; text-align:center; margin-bottom:1rem;">
                ENTER EMAIL TO RECEIVE RECOVERY LINK.
            </p>
            <div class="form-group">
                <input type="email" id="forgotEmail" placeholder="RECOVERY EMAIL ADDRESS" required>
            </div>
            <button type="submit" class="btn-main">SEND RESET LINK</button>
            <button type="button" class="link-btn" id="btnBackToLogin">CANCEL</button>
        </form>

        <div id="socialSection">
            <div style="text-align:center; margin:1rem 0; color:#444; font-size:0.8rem;">OR</div>
            <button id="btnGoogle" class="btn-google">
                <svg width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M21.35 11.1h-9.17v2.73h6.51c-.33 3.81-3.5 5.44-6.5 5.44C8.51 19.27 5 16.38 5 12c0-4.1 3.51-7.23 7.14-7.23c2.01 0 3.8.63 5.24 2.07l2.15-2.15C17.2 2.63 15.01 1.75 12.14 1.75c-5.53 0-10 4.7-10 10.5c0 5.79 4.47 10.5 10 10.5c5.07 0 9.42-3.69 9.87-9.61c.09-.94 0-1.57 0-2.04z"/></svg>
                AUTHENTICATE WITH GOOGLE
            </button>
        </div>

        <div id="statusMsg" class="error-msg"></div>
        <div id="successMsg" class="success-msg"></div>

        <a href="index" class="link-btn" style="margin-top: 2rem;">// ABORT & RETURN TO INDEX</a>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendEmailVerification, sendPasswordResetEmail, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDwIMRuv26pcAndpd36EkLbUpSGvh6ptSY",
            authDomain: "unnamed-things-website-70cf7.firebaseapp.com",
            projectId: "unnamed-things-website-70cf7",
            storageBucket: "unnamed-things-website-70cf7.firebasestorage.app",
            messagingSenderId: "293788800527",
            appId: "1:293788800527:web:575a1fd1f60d6361f3357a"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        // UI Logic
        const tabLogin = document.getElementById('tabLogin');
        const tabRegister = document.getElementById('tabRegister');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const forgotForm = document.getElementById('forgotForm');
        const socialSection = document.getElementById('socialSection');
        const statusMsg = document.getElementById('statusMsg');
        const successMsg = document.getElementById('successMsg');

        function showMsg(msg, isError = true) {
            statusMsg.style.display = isError ? 'block' : 'none';
            successMsg.style.display = isError ? 'none' : 'block';
            statusMsg.innerText = isError ? msg : '';
            successMsg.innerText = isError ? '' : msg;
        }

        tabLogin.addEventListener('click', () => {
            tabLogin.classList.add('active'); tabRegister.classList.remove('active');
            loginForm.classList.remove('hidden'); registerForm.classList.add('hidden'); forgotForm.classList.add('hidden');
            socialSection.classList.remove('hidden'); showMsg('', false);
        });

        tabRegister.addEventListener('click', () => {
            tabRegister.classList.add('active'); tabLogin.classList.remove('active');
            registerForm.classList.remove('hidden'); loginForm.classList.add('hidden'); forgotForm.classList.add('hidden');
            socialSection.classList.remove('hidden'); showMsg('', false);
        });

        document.getElementById('btnForgot').addEventListener('click', () => {
            loginForm.classList.add('hidden'); forgotForm.classList.remove('hidden'); socialSection.classList.add('hidden');
        });
        document.getElementById('btnBackToLogin').addEventListener('click', () => {
            forgotForm.classList.add('hidden'); loginForm.classList.remove('hidden'); socialSection.classList.remove('hidden');
        });

        // 1. LOGIN
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const pass = document.getElementById('loginPass').value;
            try {
                const uc = await signInWithEmailAndPassword(auth, email, pass);
                if (uc.user.emailVerified) {
                    window.location.href = "index"; // Redirect to Forum Home
                } else {
                    await signOut(auth);
                    showMsg("EMAIL NOT VERIFIED.");
                }
            } catch (error) { showMsg("LOGIN FAILED: " + error.message); }
        });

        // 2. REGISTER
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('regEmail').value;
            const pass = document.getElementById('regPass').value;
            const confirm = document.getElementById('regPassConfirm').value;
            if (pass !== confirm) { showMsg("PASSWORDS DO NOT MATCH"); return; }

            try {
                const uc = await createUserWithEmailAndPassword(auth, email, pass);
                await sendEmailVerification(uc.user);
                await signOut(auth);
                showMsg("VERIFICATION SENT. PLEASE CHECK EMAIL.", false);
                registerForm.reset();
            } catch (error) { showMsg("ERROR: " + error.message); }
        });

        // 3. GOOGLE
        document.getElementById('btnGoogle').addEventListener('click', () => {
            signInWithPopup(auth, provider).then(() => {
                window.location.href = "index";
            }).catch((error) => showMsg("AUTH ERROR: " + error.message));
        });

        // 4. FORGOT PASS
        forgotForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                await sendPasswordResetEmail(auth, document.getElementById('forgotEmail').value);
                showMsg("RESET LINK SENT.", false);
            } catch (error) { showMsg("ERROR: " + error.message); }
        });
    </script>
</body>
</html>